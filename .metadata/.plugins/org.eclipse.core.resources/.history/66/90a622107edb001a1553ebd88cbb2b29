<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="woongs">
	<select id="tags" resultType="com.woongjin.woongs.model.TagDto">
		select no, name from tag
	</select>

	<select id="subtags" resultType="map" parameterType="int">
		select *
		from sub_tag where tag_no = #{no}
	</select>

	<insert id="insertPost"
		parameterType="com.woongjin.woongs.model.PostDto">
		insert into post(user_id, category_first,
		category_second, thumbnail, title, description, price, worktime,
		retouch_count, service_description, requirement)
		values(#{user_id}, #{category_first}, #{category_second}, #{thumbnail}, #{title},
		#{description}, #{price}, #{worktime}, #{retouch_count},
		#{service_description}, #{requirement})
	</insert>

	<select id="selectPost"
		resultType="com.woongjin.woongs.model.PostDto">
		select * from post
	</select>


	<delete id="delete"
		parameterType="com.woongjin.woongs.model.PostDto">
		delete from wishlist
		where post_no = #{post_no}
	</delete>

	<select resultType="com.woongjin.woongs.model.UserDto"
		parameterType="com.woongjin.woongs.model.UserDto" id="login">select * from
		user_test where user_id = #{user_id} and user_password=
		#{user_password} </select>



	<insert parameterType="com.woongjin.woongs.model.CouponDto"
		id="issueCoupon">insert into coupon(admin_id, coupon_code, coupon_name,
		coupon_price,coupon_reg_date , coupon_validate_date,
		coupon_for_everyone)values(#{admin_id}, #{coupon_code},
		#{coupon_name}, #{coupon_price}, #{coupon_reg_date },
		#{coupon_validate_date}, #{coupon_for_everyone}) </insert>

	<select resultType="com.woongjin.woongs.model.CouponDto"
		id="selectCoupon">select * from coupon </select>

	<select resultType="String" parameterType="String"
		id="selectCouponByCode">select * from coupon where coupon_code = #{coupon_code} </select>

	<select resultType="com.woongjin.woongs.model.CouponDto"
		parameterType="String" id="selectUserCoupon">select coupon_name, coupon_price,
		coupon_validate_date from coupon ,coupon_managementwhere coupon.no =
		coupon_management.coupon_no and coupon_management.user_id=#{user_id}
	</select>

	<insert parameterType="map" id="enrollCoupon">insert into
		coupon_management(user_id, coupon_no) values(#{user_id}, #{coupon_no})
	</insert>

	<delete parameterType="int" id="deleteCoupon">delete from coupon where no =
		#{no} </delete>

	<update parameterType="String" id="updateCouponCount">update coupon set
		coupon_for_everyone= coupon_for_everyone - 1 where no =#{coupon_no}
	</update>

	<select resultType="int" parameterType="map"
		id="isAvailableCoupon">select count(*) from coupon_management where user_id=#{user_id} and
		coupon_no = #{coupon_no} </select>

	<select resultType="int" parameterType="String"
		id="isAvailableCouponCode">select coupon_for_everyone from coupon where coupon_code =
		#{coupon_code} </select>
	
</mapper>

<%@ page language="java" contentType="text/html; charset=EUC-KR"
	pageEncoding="EUC-KR"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="EUC-KR">
<title>Insert title here</title>
<script type="text/javascript"
	src="https://www.gstatic.com/charts/loader.js"></script>

</head>
<body>

	<div
		style="display: flex; width: 100%; height: 100%; border: 1px solid black;">
		<!-- 최상단 태그 -->
		<div style="height: 500px; width: 20%; border: 1px solid black"></div>
		<div style="height: 500px; width: 80%; border: 1px solid black">
			<div>수익 관리</div>
			<div style="display: flex; border: 1px solid black; magin: 5px;">
				<div
					style="height: 100px; width: 30%; border: 1px solid black; magin: 5px;">
					<div style="height: 50px;">총 수익</div>
					<div style="height: 50px;" id="totalIncome"></div>
				</div>
				<div
					style="height: 100px; width: 30%; border: 1px solid black; magin: 5px;">
					<div style="height: 50px;">확정 수익</div>
					<div style="height: 50px;" id="finshYIncome"></div>
				</div>

				<div
					style="height: 100px; width: 30%; border: 1px solid black; magin: 5px;">
					<div style="height: 50px;">확정 안된 수익</div>
					<div style="height: 50px;" id="finshNIncome"></div>
				</div>
			</div>
			<div id="chart_div"></div>

			<div>입금 계좌 등록</div>
			<div style="display: flex; border: 1px solid black; magin: 5px;">
				<div style="height: 50px; width: 30%;">
					<select id="accountSelect">

					</select>
				</div>
				<div style="height: 50px; width: 30%;">
					<input type="text" id="accountInput" />
				</div>
				<div style="height: 50px; width: 30%;">
					<button id="accountButton">선택</button>
				</div>

			</div>
		</div>
	</div>


	<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
	<script>
		$(function() {
			income.init();
		});
		var income = {
			init : function() {
				income.find_income_by_user_id();

				income.find_account_info_by_user_id();
				$("#accountButton").on("click", function() {

					alert("계좌 " + $("#accountSelect").val() + "가 선택되었습니다.")
				});
				$("#accountSelect").on("change", function() {
					$("#accountInput").val($("#accountSelect").val());

				});
			},
			find_income_by_user_id : function() {

				$.ajax({
					type : "GET",
					url : "findIncomeByUserId",
					dataType : 'json'
				}).done(
						function(datas) {
							var sumPrice = 0;
							var finshYIncome = 0;
							var finshNIncome = 0;
							var date = [0,0,0,0,0,0,0,0,0,0,0,0];

							datas.forEach(function(item, index, data) {
								if (item.FINSH_YN == "Y") {
									finshYIncome += item.PRICE;
								} else {
									finshNIncome += item.PRICE;
								} 


								sumPrice += item.PRICE;
								var PAID_DATE = new Date(item.PAID_DATE);
								PAID_DATE.toISOString().replace("T", " ")
										.substring(0, 10);
								console.log(PAID_DATE.toISOString().replace("T", " ")
										.substring(0, 10));

							});

							chartDate = [ [ 1, date[0] ], [ 2, date[1] ],
								[ 3, date[2] ], [ 4, date[3] ],
								[ 5, date[4] ], [ 6, date[5] ],
								[ 7, date[6] ], [ 8, date[7] ],
								[ 9, date[8] ], [ 10, date[9] ],
								[ 11, date[10] ], [ 12, date[11] ]];
							console.log([
								 [1, 770000]
									,[2, 170000]
									,[3, 2200000]
									,[4, 300300]	
									,[5, 3433]
									,[6, 2342342]
									,[7, 600000]
									,[8, 23423423]
									,[9, 800000]
									,[10, 777000]
									,[11, 1004000]
									,[12, 1100000]
							
								]);
							console.log(date);

							google.charts.load('current', {
								'packages' : [ 'corechart' ]
							});
							google.charts.setOnLoadCallback(drawVisualization);
							$("#totalIncome").html(sumPrice + "원");
							$("#finshYIncome").html(finshYIncome + "원");
							$("#finshNIncome").html(finshNIncome + "원");
						}).fail(function(e) {
					alert(e.responseText);
				})
			},
			find_account_info_by_user_id : function() {

				$
						.ajax({
							type : "GET",
							url : "findAccountInfoByUserId",
							dataType : 'json'
						})
						.done(
								function(datas) {
									var selectHtml = "<option value=''>::선택::</option>";
									datas
											.forEach(function(item, index, data) {
												selectHtml += "<option value="+"'"+item.account_number+"'"+">"
												selectHtml += item.bank_name
												selectHtml += "</option>"
												console.log(datas);
											});

									$("#accountSelect").append(selectHtml);
								}).fail(function(e) {
							alert(e.responseText);
						})
			}

		}

		

		function drawVisualization(chartDate) {

			/* var data = new google.visualization.DataTable(); */
			 var data = new google.visualization.DataTable();
			data.addColumn('number', 'Month');
			data.addColumn('number', 'Month Total Income');
			

			data.addRows(
					[1, 770000]
					,[2, 170000]
					,[3, 2200000]
					,[4, 300300]	
					,[5, 3433]
					,[6, 2342342]
					,[7, 600000]
					,[8, 23423423]
					,[9, 800000]
					,[10, 777000]
					,[11, 1004000]
					,[12, 1100000]
	
		);

			var options = {
				title : 'Profit management',
				vAxis : {
					title : 'Cups'
				},
				hAxis : {
					title : 'Month',
					ticks : [ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12 ]
				},
				seriesType : 'bars',
				series : {
					12 : {
						type : 'line'
					}
				},

			};

			var chart = new google.visualization.ComboChart(document
					.getElementById('chart_div'));
			chart.draw(data, options);
		}
	</script>
	<div id="chart_div"></div>

</body>
</html>